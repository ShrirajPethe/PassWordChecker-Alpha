<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Bundle JS (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&family=Cutive+Mono&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300..700&display=swap" rel="stylesheet">


    <title>Password Strength Checker</title>
    <style>
        body {
            text-align: center;
        }

        .xMarTiny {
            margin-left: .10rem;
            margin-right: .10rem;
        }

        a {
            color: rgba( var(--bs-link-opacity, 1))
        }
        /* a {
            color: rgba(var(--bs-info-rgb), var(--bs-link-opacity, 1))
        } */

        .container-md {
            padding: 4%;
        }

        .list-group list-group-flush {
            padding-left: 1rem;
            padding-right: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .card {
            margin: auto;
        }

        /* [class^="col"],.bd-example-cols [class^="col"]>*,.bd-example-cssgrid [class*="grid"]>* { */
        /* .test-row {
            padding-top: .50rem;
            padding-bottom: .50rem; */
            /* background-color: rgba(var(), 0.15);
            border: 1px solid rgba(var(), 0.3) */
        /* } */
                    /* background-color: rgba(var(--bd-violet-rgb), 0.15); */
                    /* border: 1px solid rgba(var(--bd-violet-rgb), 0.3) */

        #recommendation,
        #zrecommendation,
        #zecommendation {
            text-align: left;
            margin-top: 10px;
        }

        .Centered2Cols {
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        .noLeadBoldText {
            font-weight: 700 !important;
        }

        .tmarklowercase{
            margin-left: -0.15rem;
            margin-right: -0.15rem;
            /* background-color: var(--bs-highlight-bg); */
            background-color: #e5ffcd;
        }

        .tmarkuppercase{
            margin-left: -0.15rem;
            margin-right: -0.15rem;
            /* background-color: var(--bs-highlight-bg); */
            background-color: #cddfff;
        }

        .tmarkdigit{
            margin-left: -0.15rem;
            margin-right: -0.15rem;
            /* background-color: var(--bs-highlight-bg); */
            background-color: #fff6cd;
        }

        .tmarksymbol{
            margin-left: -0.15rem;
            margin-right: -0.15rem;
            /* background-color: var(--bs-highlight-bg); */
            background-color: #ffcdcd;
        }
        
        .lowercase {
            color: green;
        }

        .uppercase {
            color: blue;
        }

        .digit {
            color: orange;
        }

        .symbol {
            color: red;
        }

        .space {
            color: darkorchid;
        }

        /* .card > .list-group {
            border-top: inherit;
            border-bottom: inherit;
        }
        
        .card > .card-body {
            border-top: inherit;
            border-bottom: inherit;
        } */
        
        /* .card > .middle-card-body {
            border-top: inherit;
            border-bottom: inherit;
        } */

        .card > .cardBorder{
            border-top: inherit;
            padding : 0 ;
            /* border-bottom: inherit; */
        }

        
        /* border-bottom: inherit */
        /* 
        .courier-prime-regular {
            font-family: "Courier Prime", monospace !important;
            font-weight: 400 !important;
            font-style: normal !important;
        } */

        .courier-prime-bold {
            font-family: "Courier Prime", monospace !important;
            font-weight: 700 !important;
            font-style: normal !important;
        }

        .teko-light {
            font-family: "Teko", sans-serif;
            font-optical-sizing: auto;
            font-weight: 300;
            font-style: normal;
        }

        .custom-tooltip {
            --bs-tooltip-bg: var(--bd-violet-bg);
            --bs-tooltip-color: var(--bs-white);
        }

        #toggleElement {
            display: none;
            opacity: 0;
            transition: opacity 0.5s, width 0.5s, height 0.5s, margin 0.5s;

            /* EXPERIMENTAL */
            /* position:absolute; */
            /* opacity: 0; */
        }

        #password {
            border-radius: var(--bs-border-radius);
            /* border-top-right-radius: 0;
            border-bottom-right-radius: 0; */
        }


        #togglePassword {
            display: none;
            opacity: 0;
            transition: opacity 0.5s, width 0.5s, height 0.5s, margin 0.5s;
        }

        #clearPass {
            display: none;
            opacity: 0;
            transition: opacity 0.5s, width 0.5s, height 0.5s, margin 0.5s;

        }
        /* EXPERIMENTAL
        /* position:absolute; */
        /* opacity: 0;  */

        .visible {
            display: block !important;
            opacity: 1 !important;

            /* EXPERIMENTAL */
            position: static;
            /* opacity: 1; */
            transition: opacity 1s linear;
        }

        .my-card {
            transition: width 0.5s, height 0.5s, margin 0.5s;
            transition: transform 0.5s ease-in-out;
        }

        .myCardTEST {
            transition: width 1s, height 1s, margin 1s;
            transition: transform 1s ease-in-out;
        }

        #coloredPassword {
            color: var(--bs-body-color);
            /* background-color: var(--bs-body-bg); */
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .25);
        }

        .tooltip-link {
            position: relative;
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }

        .tooltip-content {
            display: none;
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            z-index: 1000;
            top: 20px;
            left: 0;
            white-space: nowrap;
        }

        .tooltip-link:hover .tooltip-content {
            display: block;
        }

    </style>
</head>

<body>

    <div class="container-md">

        <div class="card shadow-lg" id="mainCard">

            <div class="card-header Centered2Cols">

                <div class="myCardTEST">
                    <h1 class="card-title">Password Strength Checker</h1>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Enter your password, & check the strength</h6>
                </div>

                <div id="toggleElement">
                    <div class="card border-info shadow shadow-lg text-info p-1 rounded-circle my-card teko-light"
                        id="scoreCircle" style="width: 75px; height: 75px;">
                        <div class="teko-light position-absolute top-50 start-50 translate-middle "
                            style="font-size: 2.25rem;" id="finalScoreDisplay">
                        </div>
                    </div>
                </div>

            </div>

            <!-- <div class="card-body middle-card-body" style="
                height: 0px;
            "></div> -->

            <div class="card-body">
                <div class="">
                    <div class="input-group">
                        <input type="password" class="form-control text-center" placeholder="Enter your password"
                            id="password" >
                            
                        <button class="btn btn-outline-secondary" type="button" id="clearPass">
                             <!-- style="opacity: 0;" -->
                            <!-- <i class="bi bi-eye"></i> -->
                            <i class="bi bi-eraser-fill"></i>
                        </button>
    
                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="cardBorder" id="cardBorder_1">
            </div>
    
            <!-- <ul class="p-2 list-group list-group-flush">
                <li class="list-group-item">
                    <div class="Centered2Cols">
                        <div id="strength" class="lead">
                            Simple Password Strength: Empty
                        </div>
                        <div id="score" class="lead">
                            Score:
                        </div>
                    </div>
                    <div id="recommendation"></div>
                </li>
            </ul> -->

            <!-- <div class="card-body middle-card-body"> -->

            <div class="card-body" id="displayForSimple">
                <div class="Centered2Cols">
                    <div id="strength" class="lead">
                        Simple Password Strength: Empty
                    </div>
                    <div id="score" class="lead">
                        Score:
                    </div>
                </div>
                <div id="recommendation"></div>
            </div>

            <div class="cardBorder" id="cardBorder_2">
            </div>
    
            <div class="card-body" id="displayForZXCVBN">
                <div class="Centered2Cols">
                    <div id="zStrength" class="lead">
                        Advanced Password Strength: Empty
                    </div>
                    <div id="zScore" class="lead">
                        Score:
                    </div>
                </div>
                <div id="zecommendation"></div>
            </div>

            <div class="card-footer ">
                <div class="card-body" id="colorCon">
                    <div class="input-group">
                        <!--  teko-light-->
                            <!-- user-select-all -->
                        <div id="coloredPassword" style="background-color: #E9ECEF;" class="courier-prime-bold form-control user-select-none display-6" placeholder=""></div>
                    </div>
                </div>
                <div class="px-3 pb-3 Centered2Cols" id="toggleHolder">
                    <div class="lead">See Detailed Results</div>
                    <button class="btn btn-outline-info" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFooter" aria-expanded="false" aria-controls="collapseFooter">
                        Toggle Details
                    </button>
                </div>
                <div class="collapse mt-3" id="collapseFooter">
                    <div class="mb-0">
                        <div id="detailedResults" class="mx-2 font-monospace"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="../bower_components/zxcvbn/dist/zxcvbn.js">
    </script>

    <script>
        const THRESHOLD_PERCENT = 25;
        const MIN_PASSWORD_LENGTH = 8;
        const THRESHHOLD_OF_NONSPACE_CHARS = 6;
        const MAX_SIMPLE_STRENGTH = 7;
        const MAX_ADVANCED_STRENGTH = 4;
        const STRENGTH_COLORS = {
            EMPTY: 'Black',
            WEAK: '#ad1201',
            MEDIUM: '#ffcb33',
            STRONG: '#81A263',
            VERY_STRONG: '#365E32'
        };

        let logCounter = 0;

        const dom = initDOMElements();
        setupEventListeners(dom.passwordInput);
        checkPassword();

        function initDOMElements() {
            return {
                passwordInput: document.getElementById('password'),
                simpleStrengthDisplay: document.getElementById('strength'),
                simpleScoreDisplay: document.getElementById('score'),
                recommendationDisplay: document.getElementById('recommendation'),
                zStrengthDisplay: document.getElementById('zStrength'),
                zScoreDisplay: document.getElementById('zScore'),
                zRecommendationDisplay: document.getElementById('zecommendation'),
                detailedResultsDisplay: document.getElementById('detailedResults'),
                eleToggleHolder: document.getElementById('toggleHolder'),
                fancyFontClassifiedDisplay: document.getElementById('colorCon'),
                finalScoreDisplay: document.getElementById('finalScoreDisplay'),
                clearPassButton: document.getElementById('clearPass'),
                togglePasswordButton: document.getElementById('togglePassword'),
                toggleElement: document.getElementById('toggleElement'),
                collapseFooter: document.getElementById('collapseFooter'),
                coloredPasswordDiv: document.getElementById('coloredPassword'),
                scoreCircle: document.getElementById('scoreCircle'),

                displayForSimple: document.getElementById('displayForSimple'),
                displayForZXCVBN: document.getElementById('displayForZXCVBN'),
                
                cardBorder_1: document.getElementById('cardBorder_1'),
                cardBorder_2: document.getElementById('cardBorder_2'),
            };
        }

        function setupEventListeners(passwordInput) {
            passwordInput.addEventListener('keyup', debounce(checkPassword, 1000));
            dom.clearPassButton.addEventListener('click', clearPassword);
            dom.togglePasswordButton.addEventListener('click', togglePasswordVisibility);
            window.addEventListener('resize', adjustFontSize);
            dom.collapseFooter.addEventListener('show.bs.collapse', () => setTimeout(adjustFontSize, 300));
            dom.collapseFooter.addEventListener('hide.bs.collapse', () => setTimeout(adjustFontSize, 300));
        }

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        //         function htmlTagReturn(tagName, varialbe, fontWeight, fontColor) {
        // dom.simpleStrengthDisplay.innerHTML = `Simple Password Strength: <strong>${strengthText}</strong>`;
        // dom.simpleScoreDisplay.innerHTML = `Score: <strong>${strength}</strong>/7`;
        // dom.zStrengthDisplay.innerHTML = result.password ? `<strong>${zStrengthText}</strong> - ${zStrengthCap}` : `Advanced Password Strength: <strong>${zStrengthText}</strong>`;
        // dom.zScoreDisplay.innerHTML = `Score: <strong>${result.score}</strong>/4`;
        // dom.zRecommendationDisplay.innerHTML += `• <strong>${result.feedback.warning}</strong><br>`;
                    
        //             return "" ;

        //             return "" ;
        //         }

        function updateColoredPasswordDisplay(password) {
            // const coloredPasswordDiv = document.getElementById('coloredPassword');
            if (dom.coloredPasswordDiv) {
                dom.coloredPasswordDiv.innerHTML = '';

                dom.coloredPasswordDiv.addEventListener("click", (e) => {
                    navigator.clipboard.writeText(password);
                });

                for (let char of password) {
                    const span = document.createElement('span');
                    if (/[a-z]/.test(char)) {
                        span.className = 'lowercase xMarTiny noLeadBoldText display-6 courier-prime-bold';
                    } else if (/[A-Z]/.test(char)) {
                        span.className = 'uppercase xMarTiny noLeadBoldText display-6 courier-prime-bold';
                    } else if (/[0-9]/.test(char)) {
                        span.className = 'digit xMarTiny noLeadBoldText display-6 courier-prime-bold';
                    } else {
                        span.className = 'symbol xMarTiny noLeadBoldText display-6 courier-prime-bold';
                        if (char == ' ') {
                            console.log("char Is SPACE:\t", char);
                            char = '_';
                            span.className = 'space xMarTiny noLeadBoldText display-6 courier-prime-bold';
                        }
                    }
                    span.textContent = char;
                    dom.coloredPasswordDiv.appendChild(span);
                }
                adjustFontSize();
            }
        }


        function isCharacterRepeated(string, thresholdPercent) {
            const cleanedString = string.replace(/\s+/g, '');
            if (cleanedString.length === 0) return false;

            const thresholdCount = (thresholdPercent / 100) * cleanedString.length;
            const frequencyMap = {};

            for (let char of cleanedString) {
                frequencyMap[char] = (frequencyMap[char] || 0) + 1;
            }

            return Object.values(frequencyMap).some(count => count > thresholdCount);
        }
            // var passHolder = document.getElementById("coloredPassword");

            // if (passHolder) {
            //     passHolder.addEventListener("click", (e) => {
            //         navigator.clipboard.writeText(password);
            //     });
            // }

        function adjustFontSize() {
            const passHolder = dom.coloredPasswordDiv;
            // if (!passHolder) console.log("adjustFontSize\t\t--!passHolder");
            // if (passHolder.children.length === 0) console.log("adjustFontSize\t\t--passHolder.children.length === 0");
            // if (!passHolder.parentElement) console.log("adjustFontSize\t\t--!passHolder.parentElement");
            // if (!passHolder || passHolder.children.length === 0 || !passHolder.parentElement)   console.log("adjustFontSize\t\t--ALL 3");
            //return ;
            ///////////////////
            if (!passHolder || passHolder.children.length === 0 || !passHolder.parentElement)   return;

            const maxWidth = passHolder.parentElement.clientWidth - 20;
            if (maxWidth <= 0) return;

            const minFontSize = 16;
            let computedFontSize = parseFloat(window.getComputedStyle(passHolder.children[0]).fontSize);

            function setFontSize(fontSize) {
                Array.from(passHolder.children).forEach(child => child.style.fontSize = `${fontSize}px`);
            }

            setFontSize(computedFontSize);
            while (computedFontSize > minFontSize) {
                setFontSize(computedFontSize);
                if (passHolder.parentElement.clientHeight <= 65) break;
                computedFontSize -= 1;
            }

            if (computedFontSize <= minFontSize) setFontSize(minFontSize);
        }

        function applyStylesBasedOnValue(element, seconds) {
            const color = passBreakingColor(seconds);
            element.style.backgroundColor = `rgba(${color}, 0.15)`;
            element.style.border = `1px solid rgba(${color}, 0.3)`;
        }

        function passBreakingColor(seconds) {
            if (seconds <= 31622401) return '173, 18, 1';
            if (seconds <= 3162240009) return '255, 203, 51';
            return '54, 94, 50';
        }

        function checkPassword() {
            const password = dom.passwordInput.value;
            const result = zxcvbn(password);
            console.log("result.pass:\t---------------\t", result.password, "\nresult:\t---------------\t", result);

            initializeTooltips();

            // handleEmptyPassword(password) ;
            if (handleEmptyPassword(password)) {
                // continue;
            } else {
                return;
            }

            const { strength, suggestionsList } = calculateStrength(password);
            updateSimpleStrengthDisplay(strength, suggestionsList);
            
            updateAdvancedStrengthDisplay(result);
            displayDetailedResults(result);
            
            displayFinalResults(strength, result);
            // handleEmptyPassword(password) ;
            
            // handleEmptyPassword(password) ;
            
        }

        //////////////////
        // passIsMT = true;
        //     eleToggleHolder.hidden = true;
        //     fancyFontClassifiedDisplay.hidden = true;
        // } else {
        //     passIsMT = false;
        //     eleToggleHolder.hidden = false;
        //     fancyFontClassifiedDisplay.hidden = false;

        // if (passIsMT) {
        //     HideRES();
        //     adjustFontSize();
        //     // checkPassword();
        //     zRecommendationDisplay.innerHTML = ''
        //     recommendationDisplay.innerHTML = ''
        //     detailedResultsDisplay.innerHTML = ''
        //     // eleToggleHolder.style.display = "none";
        //     eleToggleHolder.hidden = true;
        //     fancyFontClassifiedDisplay.hidden = true;
        // } else {
        //     displayFinalResults(strength, result, combinedScore);
        // }
        ////////////////////



        function handleEmptyPassword(password) {
            // console.log("INCOMING pass\t",password);
            if (!password) {
                dom.clearPassButton.classList.remove('visible');
                dom.togglePasswordButton.classList.remove('visible');
                // dom.passwordInput.style.borderTopRightRadius = 0 ;
                // dom.passwordInput.style.borderBottomRightRadius = 0 ;
                /* border-top-right-radius: 0;
            border-bottom-right-radius: 0; */
                
                dom.eleToggleHolder.hidden = true;
                dom.fancyFontClassifiedDisplay.hidden = true;
                dom.recommendationDisplay.hidden = true;
                dom.zRecommendationDisplay.hidden = true;
                dom.displayForSimple.hidden = true;
                dom.displayForZXCVBN.hidden = true;

                dom.cardBorder_1.hidden = true;
                dom.cardBorder_2.hidden = true;
                
                dom.passwordInput.style.fontSize = '2rem';
                // dom.passwordInput.style.fontSize = '7rem';
                // dom.passwordInput.style.fontSize = '5%' ;
                // dom.passwordInput.style.fontSize = '5%' ;
                // dom.passwordInput.style.fontSize = '15rem';
                HideRES();
                
                return false;
            } else {
                updateColoredPasswordDisplay(password);
                dom.clearPassButton.classList.add('visible');
                dom.togglePasswordButton.classList.add('visible');
                
                dom.passwordInput.style.borderTopRightRadius = 0 ;
                dom.passwordInput.style.borderBottomRightRadius = 0 ;
                
                dom.eleToggleHolder.hidden = false;
                dom.fancyFontClassifiedDisplay.hidden = false;
                dom.recommendationDisplay.hidden = false;
                dom.zRecommendationDisplay.hidden = false;
                dom.displayForSimple.hidden = false;
                dom.displayForZXCVBN.hidden = false;

                dom.cardBorder_1.hidden = false;
                dom.cardBorder_2.hidden = false;
                dom.passwordInput.style.fontSize = '1rem';

                // adjustFontSize();
                ShowRES();
                return true;
            }
        }

        function logger(txt, variable) {
            // console.log(logCounter,".\t:  ",txt ,"\t" , variable);
            logCounter++;
            // console.log(logCounter,".\t:score\t",variable ,"\t" , txt);
            console.log("",logCounter,".\t:score\t",variable ,"\t" , txt);
        }

        function calculateStrength(password) {
            let strength = 0;
            const suggestionsList = [];
            logger("Very Beginning", strength);

            if (!isWhitespaceString(password) && (password.replace(/\s+/g, '')).length >= MIN_PASSWORD_LENGTH) {
                strength++;
                logger("Non SpaceChars are above the minimum Leng", strength);
                if ((password.length - (password.replace(/\s+/g, '')).length) <= (50 / 100 * password.length)) {
                    if (!isCharacterRepeated(password, 55)) {
                        if (isCharacterRepeated(password, 50)) {
                            strength++;
                            logger("if (isCharacterRepeated(password, 50)) {", strength);
                        } else {
                            strength += Math.min(2, Math.floor((password.length - MIN_PASSWORD_LENGTH) / 4));
                            logger("strength += Math.min(2, Math.floor((password.length - MIN_PASSWORD_LENGTH) / 4));", strength);
                        }
                    }
                } else {
                    logger("Space is above 50% NOTHING ADDED", "");
                    suggestionsList.push('Space shall not be 50% or more of your password');
                }
            } else {
                suggestionsList.push('Password should be at least 8 characters long, excluding spaces');
                // logger("This oneis NOT 8 characters long, excluding spaces", strength);
            }


            if ( (password.replace(/\s+/g, '')).length>=18 && (password.length>=45) ) {
                strength++;
                logger("Non space Chars are Above 18 &&& total Length above 45 ", strength);
                // logger("ELSE or NOT  - -(password.length - (password.replace(/\s+/g, '')).length) <= (50 / 100 * password.length)", strength);
                if ((password.replace(/\s+/g, '')).length>=40 || (password.length>=55) ) {
                    strength++;
                    logger("Non space Chars are Above 40 || length above 55", strength);
                    if ((password.length>=65) ) {
                        strength++;
                        logger("length above 65", strength);
                    }
                }
            }
 
            logger("After 1st Section", strength);

            if (password.match(/[a-z]+/)) {
                strength += (password.replace(/\s+/g, '')).length > THRESHHOLD_OF_NONSPACE_CHARS ? 1 : 0.5;
                logger("MADE THE Match /[a-z]+/", strength);
            } else {
                // suggestionsList.push('Include at least one lowercase letter');
                suggestionsList.push('<div class="lowercase" style="display: contents; margin-bottom:2px">Include at <mark class="tmarklowercase">least one lowercase</mark> letter</div>');
            }

            if (password.match(/[A-Z]+/)) {
                strength += (password.replace(/\s+/g, '')).length > THRESHHOLD_OF_NONSPACE_CHARS ? 1 : 0.5;
                logger("MADE THE Match /[A-Z]+/", strength);
            } else {
                // suggestionsList.push('Include at least one uppercase letter');
                suggestionsList.push('<div class="uppercase" style="display: contents;">Include at <mark class="tmarkuppercase">least one uppercase</mark> letter</div>');
            }

            if (password.match(/[0-9]+/)) {
                strength += (password.replace(/\s+/g, '')).length > THRESHHOLD_OF_NONSPACE_CHARS ? 1 : 0.5;
                logger("MADE THE Match /[0-9]+/", strength);
            } else {
                // suggestionsList.push('Include at least one digit');
                suggestionsList.push('<div class="digit" style="display: contents;">Include at <mark class="tmarkdigit">least one digit</mark></div>');
            }

            if (password.match(/[@$!%*?&#]+/)) {
                strength += (password.replace(/\s+/g, '')).length > THRESHHOLD_OF_NONSPACE_CHARS ? 1 : 0.5;
                logger("MADE THE Match (/[@$!%*?&#]+/))", strength);
            } else {
                // suggestionsList.push('Include at least one special character (@, $, !, %, *, ?, & or #)');
                suggestionsList.push('<div class="symbol" style="display: contents;">Include at <mark class="tmarksymbol">least one special character (@, $, !, %, *, ?, & or #)</mark></div>');
            }

            logger("AFTER ALL the Main Checks", strength);

            strength = Math.min(strength, MAX_SIMPLE_STRENGTH);

            if ((password.replace(/\s+/g, '')).length > 5 && isCharacterRepeated(password, THRESHOLD_PERCENT)) {
                if (isCharacterRepeated(password, 50)) {
                    if (isCharacterRepeated(password, 95)) {
                        suggestionsList.push(`Please make sure that no single character is repeated more than 95%`);
                        strength -= 2;
                        logger("isCharacterRepeated(password, 95) -= 2;", strength);
                    } else {
                        suggestionsList.push(`Please make sure that no single character is repeated more than 50%`);
                    }
                } else {
                    suggestionsList.push(`Make sure that no single character is repeated more than ${THRESHOLD_PERCENT}%`);
                }
            }

            if (password.length < 20 || strength <= 3) {
                suggestionsList.push('Please try to add more characters and complexity');
            }

            logger("FiNAL:\t", strength);
            return { strength, suggestionsList };
        }

        function updateSimpleStrengthDisplay(strength, suggestionsList) {
            const { strengthText, strengthColor } = getStrengthDetails(strength);
            dom.simpleStrengthDisplay.innerHTML = `Simple Password Strength: <strong style="font-weight: 700;">${strengthText}</strong>`;
            dom.simpleStrengthDisplay.style.color = strengthColor;
            dom.simpleScoreDisplay.innerHTML = `Score: <strong style="font-weight: 700;">${strength}</strong>/7`;
            dom.simpleScoreDisplay.style.color = strengthColor;

            if (suggestionsList.length > 0) {
                dom.recommendationDisplay.innerHTML = 'Suggestions to improve your password:<br>' + suggestionsList.map(suggestion => `• ${suggestion}`).join('<br>');
            } else {
                dom.recommendationDisplay.textContent = 'Great job! Your password is strong. Remember to use unique passwords for different accounts.';
            }
        }

        function getStrengthDetails(strength) {
            let strengthText, strengthColor;
            switch (true) {
                case (strength === 0):
                    strengthText = 'Empty';
                    strengthColor = STRENGTH_COLORS.EMPTY;
                    break;
                case (strength <= 2):
                    strengthText = 'Weak';
                    strengthColor = STRENGTH_COLORS.WEAK;
                    break;
                case (strength <= 4):
                    strengthText = 'Medium';
                    strengthColor = STRENGTH_COLORS.MEDIUM;
                    break;
                case (strength <= 6):
                    strengthText = 'Strong';
                    strengthColor = STRENGTH_COLORS.STRONG;
                    break;
                default:
                    strengthText = 'Very Strong';
                    strengthColor = STRENGTH_COLORS.VERY_STRONG;
            }
            return { strengthText, strengthColor };
        }

        function updateAdvancedStrengthDisplay(result) {
            const { zStrengthText, zStrengthCap, zStrengthColor } = getAdvancedStrengthDetails(result);
            dom.zStrengthDisplay.innerHTML = result.password ? `<strong style="font-weight: 700;">${zStrengthText}</strong> - ${zStrengthCap}` : `Advanced Password Strength: <strong style="font-weight: 700;">${zStrengthText}</strong>`;
            dom.zScoreDisplay.innerHTML = `Score: <strong style="font-weight: 700;">${result.score}</strong>/4`;
            dom.zStrengthDisplay.style.color = zStrengthColor;
            dom.zScoreDisplay.style.color = zStrengthColor;

            if (result.feedback && (result.feedback.suggestions.length > 0 || result.feedback.warning)) {
                dom.zRecommendationDisplay.innerHTML = 'Suggestions to improve your password:<br>';
                if (result.feedback.warning) {
                    dom.zRecommendationDisplay.innerHTML += `• <strong style="font-weight: 700; color: ${STRENGTH_COLORS.WEAK} ">${result.feedback.warning}</strong><br>`;
                }
                dom.zRecommendationDisplay.innerHTML += result.feedback.suggestions.map(suggestion => `• ${suggestion}`).join('<br>');
            } else {
                dom.zRecommendationDisplay.textContent = 'Great job! Your password is strong. Remember to use unique passwords for different accounts.';
            }
        }

        function getAdvancedStrengthDetails(result) {
            let zStrengthText, zStrengthCap, zStrengthColor;
            switch (result.score) {
                case 0:
                    if (!result.password) {
                        zStrengthText = 'Empty';
                        zStrengthCap = ' ';
                        zStrengthColor = STRENGTH_COLORS.EMPTY;
                    } else {
                        zStrengthText = 'Too Guessable';
                        zStrengthCap = 'Risky. Less Than 1,000 Guesses';
                        zStrengthColor = STRENGTH_COLORS.WEAK;
                    }
                    break;
                case 1:
                    zStrengthText = 'Very Guessable';
                    zStrengthCap = 'Protection From Throttled Online Attacks';
                    zStrengthColor = STRENGTH_COLORS.WEAK;
                    break;
                case 2:
                    zStrengthText = 'Somewhat Guessable';
                    zStrengthCap = 'Protection From Unthrottled Online Attacks';
                    zStrengthColor = STRENGTH_COLORS.MEDIUM;
                    break;
                case 3:
                    zStrengthText = 'Safely Unguessable';
                    zStrengthCap = 'Moderate Protection From Offline Slow-Hash Scenario';
                    zStrengthColor = STRENGTH_COLORS.STRONG;
                    break;
                case 4:
                    zStrengthText = 'Very Unguessable';
                    zStrengthCap = 'Strong Protection From Offline Slow-Hash Scenario';
                    zStrengthColor = STRENGTH_COLORS.VERY_STRONG;
                    break;
            }
            return { zStrengthText, zStrengthCap, zStrengthColor };
        }

        function displayDetailedResults(result) {
            let detailedResults = `
                <div class="Centered2Cols">
                    <div>
                        <a class="tooltip-link" href="#" data-bs-toggle="tooltip">
                            <strong>Guesses</strong>: ${result.guesses}
                            <span class="tooltip-content">Estimated Guesses Needed To Crack Password</span>
                        </a>
                    </div>
                    <div>
                        <a class="tooltip-link" href="#" data-bs-toggle="tooltip">
                            <strong>Guesses Log10</strong>: ${result.guesses_log10}
                            <span class="tooltip-content">Order Of Magnitude Of Guesses</span>
                        </a>
                    </div>
                </div>
            `;

            result.sequence.forEach(seq => {
                detailedResults += `
                    <ul>
                        <li><strong>Pattern</strong>: ${seq.pattern}</li>
                        <li><strong>Token</strong>: ${seq.token}</li>
                        <li><strong>Start Index (i)</strong>: ${seq.i}</li>
                        <li><strong>End Index (j)</strong>: ${seq.j}</li>
                        <li><strong>Guesses</strong>: ${seq.guesses}</li>
                        <li><strong>Guesses Log10</strong>: ${seq.guesses_log10}</li>
                `;

                if (seq.pattern === 'sequence') {
                    detailedResults += `
                        <li><strong>Sequence Name</strong>: ${seq.sequence_name}</li>
                        <li><strong>Sequence Space</strong>: ${seq.sequence_space}</li>
                        <li><strong>Ascending</strong>: ${seq.ascending}</li>
                    `;
                } else if (seq.pattern === 'dictionary') {
                    detailedResults += `
                        <li><strong>Matched Word</strong>: ${seq.matched_word}</li>
                        <li><strong>Rank</strong>: ${seq.rank}</li>
                        <li><strong>Dictionary Name</strong>: ${seq.dictionary_name}</li>
                        <li><strong>Reversed</strong>: ${seq.reversed}</li>
                        <li><strong>Leetspeak</strong>: ${seq.l33t}</li>
                        <li><strong>Base Guesses</strong>: ${seq.base_guesses}</li>
                        <li><strong>Uppercase Variations</strong>: ${seq.uppercase_variations}</li>
                        <li><strong>Leetspeak Variations</strong>: ${seq.l33t_variations}</li>
                    `;
                }

                detailedResults += '</ul>';
            });

            dom.detailedResultsDisplay.innerHTML = detailedResults;
        }

        function displayFinalResults(strength, result) {
            const grandTotal = strength + result.score;
            console.log("Strength:", strength);
            console.log("Result Score:", result.score);
            console.log("Grand Total:", grandTotal);

            // ShowRES();

            let finalScore = calculateFinalScore(strength, result);
            applyBootstrapClass(finalScore);

            if (finalScore < 12) {
                // dom.finalScoreDisplay.textContent = `${finalScore.toFixed(3)}`;
                dom.finalScoreDisplay.innerHTML = `<span style="font-size: 2.50rem" class="align-middle">${finalScore.toFixed(3)}</span>`;
                setTimeout(() => {  
                    dom.finalScoreDisplay.innerHTML = `${finalScore.toFixed(1)}<span style="font-size: 1.75rem" class="align-middle">/12</span>`;
                }, 1000);
            } else {
                dom.finalScoreDisplay.innerHTML = `<span style="font-size: 3.75rem" class="align-middle">${finalScore.toFixed(0)}</span><span style="font-size: 1.75rem" class="align-middle">/12</span>`;
                // dom.finalScoreDisplay.innerHTML = `<span>${finalScore.toFixed(0)}</span><span>/12</span>`;
            }

            console.log("\nFinal Score:", finalScore);
            // handleEmptyPassword(result.password) ;

        }

        function calculateFinalScore(strength, result) {
            let finalScore = strength + result.score;
            let punishment = 0;
            let xtemp = 0;

            if ((result.password.replace(/\s+/g, '')).length > 5) {
                if (isCharacterRepeated(result.password, 55)) punishment += 0.5;
                if (isCharacterRepeated(result.password, 95)) punishment += 0.75;
            }

            if (result.crack_times_seconds.online_throttling_100_per_hour < 5270400) punishment += 0.80;
            if (result.crack_times_seconds.online_no_throttling_10_per_second < 31622401) punishment += 0.75;

            if (result.crack_times_seconds.offline_fast_hashing_1e10_per_second < 500) {
                punishment += 1.5;
            } else if (result.crack_times_seconds.offline_fast_hashing_1e10_per_second < 5356800) {
                punishment += 0.75;
            } else if (result.crack_times_seconds.offline_fast_hashing_1e10_per_second < 473040000) {
                punishment += 0.5;
            } else if (result.score === 4) {
                xtemp = getXtTemp(result, strength);
            }

            finalScore = finalScore - punishment + xtemp;
            finalScore = Math.max(0, Math.min(finalScore, 12));

            return finalScore;
        }

        function getXtTemp(result, strength) {
            if (result.crack_times_seconds.offline_fast_hashing_1e10_per_second > 3153600099 || result.crack_times_display.offline_fast_hashing_1e10_per_second === "centuries") {
                return strength <= 4 ? 0.65 : strength === 5 ? 0.75 : strength === 6 ? 0.85 : 1;
            } else {
                return strength <= 5 ? 0.15 : strength === 6 ? 0.25 : 0.35;
            }
        }

        function applyBootstrapClass(finalScore) {
            const scoreClasses = {
                success: { border: 'border-success', text: 'text-success', color: '#198754', shadow: 'rgb(25, 135, 84, .55)' },
                warning: { border: 'border-warning', text: 'text-warning', color: '#ffb007', shadow: 'rgb(255, 193, 7, .55)' },
                danger: { border: 'border-danger', text: 'text-danger', color: '#dc3545', shadow: 'rgb(220, 56, 72, .55)' }
            };

            const scoreClass = finalScore >= 11.5 ? scoreClasses.success : finalScore >= 8 ? scoreClasses.warning : scoreClasses.danger;

            dom.scoreCircle.classList.remove('border-success', 'text-success', 'border-warning', 'text-warning', 'border-danger', 'text-danger', 'border-info', 'text-info', );
            dom.scoreCircle.classList.add(scoreClass.border, scoreClass.text);
            dom.coloredPasswordDiv.style.borderColor = scoreClass.color;
            dom.coloredPasswordDiv.style.outline = '0';
            dom.coloredPasswordDiv.style.boxShadow = `0 0 0 .25rem ${scoreClass.shadow}`;
        }

        function initializeTooltips() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
        }

        function clearPassword() {
            dom.passwordInput.value = '';
            dom.passwordInput.classList.remove('visible');
            checkPassword();
        }

        function togglePasswordVisibility() {
            const type = dom.passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            dom.passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="bi bi-eye-fill"></i>' : '<i class="bi bi-eye-slash-fill"></i>';
        }

        function isWhitespaceString(str) {
            return !str.replace(/\s/g, '').length;
        }

        function HideRES() {
            // console.log("AttemptToHide.");
            setTimeout(() => {
                dom.toggleElement.classList.remove('visible');
                // console.log("after.toggleElement.classList.remove('visible");
                // console.log("before.setTimeout");
                setTimeout(() => {
                    dom.toggleElement.style.display = 'none';
                    // console.log("after.dom.toggleElement.style.display = 'none");
                }, 500);
            }, 500);
        } 

        function ShowRES() {
            // console.log("AttemptToShow.");
            dom.toggleElement.style.display = 'block';
            setTimeout(() => {
                dom.toggleElement.classList.add('visible');
            }, 10);
        }
    </script>
</body>